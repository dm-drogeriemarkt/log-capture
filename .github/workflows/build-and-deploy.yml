name: Build with Maven and deploy Sonatype OSS repo

on:
  push:
  # tags: # TODO: how to run if a tag is created?

jobs:
  environment: master # TODO: should be named oss nexus or similar
  buildit:
    uses: ./.github/workflows/run-with-maven.yml
    with:
      COMMAND: mvn --batch-mode -Dmaven.compiler.showDeprecation=true -Dmaven.compiler.showWarnings=true clean verify
  deploy:
    uses: ./.github/workflows/run-with-maven.yml
    with:
      COMMAND: ./.github/sign_and_deploy.sh
      GPG_KEYNAME: ${{ secrets.GPG_KEYNAME }}
      GPG_PASSPHRASE: ${{ secrets.GPG_PASSPHRASE }}
      GPG_KEY_BASE64: ${{ secrets.GPG_KEY_BASE64 }}
      OSSRH_JIRA_PASSWORD: ${{ secrets.OSSRH_JIRA_PASSWORD }}
      OSSRH_JIRA_USERNAME: ${{ secrets.OSSRH_JIRA_USERNAME}}
